ekf_filter_node:
  ros__parameters:
    frequency: 50.0
    sensor_timeout: 1.0

    two_d_mode: true

    transform_time_offset: 0.0
    transform_timeout: 0.5

    print_diagnostics: true
    debug: false

    # --------------------------
    # ODOM (wheel)
    # --------------------------
    odom0: /odom
    # Use ONLY x velocity from wheel odom
    # [x, y, z, roll, pitch, yaw, vx, vy, vz, vroll, vpitch, vyaw, ax, ay, az]
    odom0_config: [false, false, false,
                   false, false, false,
                   true,  false, false,
                   false, false, false,
                   false, false, false]

    odom0_differential: false
    odom0_relative: false
    odom0_queue_size: 5
    odom0_nodelay: true
    odom0_pose_rejection_threshold: 2.0
    odom0_twist_rejection_threshold: 2.0

    # --------------------------
    # IMU (gyro yaw rate)
    # --------------------------
    imu0: /livox/imu_remapped

    # Use ONLY yaw angular velocity (vyaw)
    imu0_config: [false, false, false,
                  false, false, false,
                  false, false, false,
                  false, false, true,
                  false, false, false]

    imu0_differential: false
    imu0_remove_gravitational_acceleration: true

    imu0_queue_size: 10
    imu0_qos: "sensor_data"     # <-- was "reliable"
    imu0_nodelay: true
    imu0_relative: false        # <-- was true

    imu0_pose_rejection_threshold: 2.0
    imu0_twist_rejection_threshold: 2.0
    imu0_linear_acceleration_rejection_threshold: 2.0

    # --------------------------
    # Frames
    # --------------------------
    odom_frame: odom
    base_link_frame: base_link
    world_frame: odom
    publish_tf: true

    predict_to_current_time: true
    smooth_lagged_data: false

    # --------------------------
    # Optional: reduce yaw drift by trusting the gyro less via process noise
    #
    # This does NOT replace proper IMU covariance, but helps when the IMU
    # publishes 0 covariance (too "perfect").
    # --------------------------
    process_noise_covariance: [
      0.05, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
      0.0,  0.05, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
      0.0,  0.0,  0.01, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
      0.0,  0.0,  0.0,  0.02, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
      0.0,  0.0,  0.0,  0.0,  0.02, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
      0.0,  0.0,  0.0,  0.0,  0.0,  0.10, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,

      0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.10, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
      0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.10, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,
      0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.10, 0.0,  0.0,  0.0,  0.0,  0.0,  0.0,

      0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.05, 0.0,  0.0,  0.0,  0.0,  0.0,
      0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.05, 0.0,  0.0,  0.0,  0.0,
      0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.20, 0.0,  0.0,  0.0,

      0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.20, 0.0,  0.0,
      0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.20, 0.0,
      0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.0,  0.20
    ]