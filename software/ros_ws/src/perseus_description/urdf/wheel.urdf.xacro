<?xml version="1.0"?>
<robot name="wheel" xmlns:xacro="http://ros.org/wiki/xacro">

<xacro:macro name="wheel" params="prefix:=^ side:=^ end:=^">
  <link name="${prefix}${end}_${side}_wheel">
    <inertial>
      <xacro:if value="${side == 'left'}">
        <origin xyz="0.0 0.0  0.0" rpy="0.0 0.0 ${pi}"/>
      </xacro:if>
      <xacro:if value="${side == 'right'}">
        <origin xyz="0.0 0.0  0.0" rpy="0.0 0.0 0.0"/>
      </xacro:if>
      <mass value="${wheel_mass}"/>        
      <xacro:cylinder_inertia m="${wheel_mass}" radius="${wheel_radius}" length="${wheel_length}"/>
    </inertial>
    <visual>
      <xacro:if value="${side == 'left'}">
        <origin xyz="0.0 0.0  0.0" rpy="0.0 0.0 ${pi}"/>
      </xacro:if>
      <xacro:if value="${side == 'right'}">
        <origin xyz="0.0 0.0  0.0" rpy="0.0 0.0 0.0"/>
      </xacro:if>
      <geometry>
        <mesh scale="0.1 0.1  0.1" filename="file://$(find perseus_description)/meshes/wheel.dae"/>
      </geometry>
    </visual>
    <collision>
      <xacro:if value="${side == 'left'}">
        <origin xyz="0.0 0.0 0.0" rpy="${pi/2} 0.0 ${pi}"/>
      </xacro:if>
        <xacro:if value="${side == 'right'}">
      <origin xyz="0.0 0.0 0.0" rpy="${pi/2} 0.0 0.0"/>
      </xacro:if>
      <geometry>
        <cylinder radius="${wheel_radius}" length="${wheel_length}"/>
      </geometry>
    </collision>
  </link>

  <joint name="${prefix}${end}_${side}_wheel_joint" type="continuous">
    <xacro:if value="${side == 'left'}">
      <origin xyz="0 ${wheels_y_offset} 0.0" rpy="0.0 0.0 0"/>
      <axis xyz="0 1 0" rpy="0 0 0"/>
    </xacro:if>
    <xacro:if value="${side == 'right'}">
      <origin xyz="0 ${-wheels_y_offset} 0.0" rpy="0.0 0.0 ${pi}"/>
      <axis xyz="0 -1 0" rpy="0 0 0"/>
    </xacro:if>
    <dynamics damping="0.2" friction="0.3"/>
    <parent link="${prefix}${end}_${side}_motor"/>
    <child link="${prefix}${end}_${side}_wheel"/>
  </joint>



  <gazebo reference="${prefix}${end}_${side}_wheel">
    <!-- TODO: Fix the material tag (this isn't the proper way to do it, and spits out warnings) -->
    <material>Gazebo/Orange</material>
    <!-- see http://sdformat.org/spec?ver=1.12&elem=collision -->
    <collision>
      <surface>
          <friction>
              <ode>
                  <!--
                  In this case, the wheels need lower sideways than forwards coefficients of friction
                  so that the rover can turn (skid steer) -->
                  <!-- forward coefficient of friction -->
                  <mu>0.3</mu>
                  <!-- perpendicular coefficient of friction -->
                  <mu2>1</mu2>
                  <!--
                  However, since mu/mu2 are normally relative to world coordinates,
                  the rover would only be able to turn 90 degrees either way before they swapped, making turning impossible.
                  To solve this, we need to specify the direction that mu/mu2 are relative to.
                  -->
                  <fdir1>1 0 0</fdir1>
              </ode>
          </friction>
      </surface>
    </collision>
  </gazebo>
</xacro:macro>

<xacro:wheel prefix="" side="left"  end="front"/>
<xacro:wheel prefix="" side="left"  end="rear"/>
<xacro:wheel prefix="" side="right" end="front"/>
<xacro:wheel prefix="" side="right" end="rear"/>


</robot>
