<?xml version="1.0"?>
<robot xmlns:xacro="http://ros.org/wiki/xacro">
  <xacro:macro name="perseus" params="prefix">

    <!-- Constants for robot dimensions -->
    <xacro:property name="scale_factor" value="1"/>  <!-- 1 for Perseus and 2 for Perseu_Lite -->

    <xacro:property name="PI" value="3.1415926535897931"/>

    <!-- Chassis Properties -->
    <xacro:property name="base_mass" value="0.3" /> <!-- arbitrary value for base mass -->
    <xacro:property name="chassis_width" value="0.45" />
    <xacro:property name="chassis_length" value="0.6" />
    <xacro:property name="chassis_height" value="0.2" />
    <xacro:property name="chassis_z_offset" value="0.35" /> <!-- Space btw top of beam and the each joint -->

    <!-- Flange Bearing Properties -->
    <xacro:property name="flange_bearing_z_offset" value="0.1"/>  

    <!-- Rocker Properties -->
    <xacro:property name="rocker_base_distance" value="0.275" /> 
    <xacro:property name="rocker_x_offset" value="0.075"/>  
    <xacro:property name="rocker_y_offset" value="0.05"/>  

    <!-- Motors Properties -->
    <xacro:property name="motors_y_offset" value="0.035"/>  
    <xacro:property name="motors_z_offset" value="-0.25"/>  
    <xacro:property name="front_motors_x_offset" value="0.3"/>  
    <xacro:property name="rear_motors_x_offset" value="-0.55"/>  
    
    <!-- Wheels Properties -->
    <xacro:property name="wheels_y_offset" value="0.125"/> 
    <xacro:property name="wheel_mass" value="1.0"/>
    <xacro:property name="wheel_radius" value="0.15"/>
    <xacro:property name="wheel_length" value="0.14"/>

    <!-- ADD COMPONENTS -->
    <xacro:include filename="$(find perseus_description)/urdf/inertia_macros.xacro"/>
    <xacro:include filename="$(find perseus_description)/urdf/chassis.urdf.xacro"/>
    <xacro:include filename="$(find perseus_description)/urdf/flange_bearing.urdf.xacro"/>
    <xacro:include filename="$(find perseus_description)/urdf/rocker.urdf.xacro"/>
    <xacro:include filename="$(find perseus_description)/urdf/motor_wheel.urdf.xacro"/>
    <xacro:include filename="$(find perseus_description)/urdf/wheel.urdf.xacro"/>
    <xacro:include filename="$(find perseus_description)/urdf/sensors.urdf.xacro"/>

    <!-- An empty base_link to attach everything to -->
    <link name="${prefix}base_link"/> 


    <joint name="${prefix}chassis_joint" type="fixed"> <!-- Joint Connect base_link and chassis -->
      <origin xyz="0 0.0 ${chassis_z_offset/scale_factor}" rpy="0.0 0.0 0.0"/>
      <parent link="${prefix}base_link"/>
      <child link="${prefix}chassis"/>
    </joint>

    <joint name="${prefix}flange_bearing_joint" type="fixed">
      <origin xyz="${-chassis_length/scale_factor} 0.0 ${flange_bearing_z_offset/scale_factor}" rpy="0 0 0"/>
      <parent link="${prefix}chassis"/>
      <child link="${prefix}flange_bearing"/>
    </joint>

    <joint name="${prefix}left_rocker_joint" type="fixed">
      <origin xyz="${-rocker_x_offset/scale_factor} ${rocker_base_distance/scale_factor} ${rocker_y_offset/scale_factor} " rpy="0 0 0"/>
      <parent link="${prefix}chassis"/>
      <child link="${prefix}left_rocker"/>
    </joint>

    <joint name="${prefix}right_rocker_joint" type="fixed">
      <origin xyz="${-rocker_x_offset/scale_factor} ${-rocker_base_distance/scale_factor} ${rocker_y_offset/scale_factor} " rpy="0 0 0"/>
      <parent link="${prefix}chassis"/>
      <child link="${prefix}right_rocker"/>
    </joint>

    <joint name="${prefix}front_left_motor_joint" type="fixed">
      <parent link="${prefix}left_rocker"/>
      <child link="${prefix}front_left_motor"/>
      <origin xyz="${front_motors_x_offset/scale_factor} -${motors_y_offset/scale_factor} ${motors_z_offset/scale_factor}" rpy="0.0 0.0 0"/>
    </joint>

    <joint name="${prefix}rear_left_motor_joint" type="fixed">
      <parent link="${prefix}left_rocker"/>
      <child link="${prefix}rear_left_motor"/>
      <origin xyz="${rear_motors_x_offset/scale_factor} -${motors_y_offset/scale_factor} ${motors_z_offset/scale_factor}" rpy="0.0 0.0 0.0"/>
    </joint>

    <joint name="${prefix}front_right_motor_joint" type="fixed">
      <parent link="${prefix}right_rocker"/>
      <child link="${prefix}front_right_motor"/>
      <origin xyz="${front_motors_x_offset/scale_factor} ${motors_y_offset/scale_factor} ${motors_z_offset/scale_factor}" rpy="0.0 0.0 0"/>
    </joint>

    <joint name="${prefix}rear_right_motor_joint" type="fixed">
      <parent link="${prefix}right_rocker"/>
      <child link="${prefix}rear_right_motor"/>
      <origin xyz="${rear_motors_x_offset/scale_factor} ${motors_y_offset/scale_factor} ${motors_z_offset/scale_factor}" rpy="0.0 0.0 0.0"/>
    </joint>


    <joint name="${prefix}front_left_wheel_joint" type="continuous">
      <axis xyz="0 1 0" rpy="0 0 0"/>
      <parent link="${prefix}front_left_motor"/>
      <child link="${prefix}front_left_wheel"/>
      <origin xyz="0 ${wheels_y_offset/scale_factor} 0.0" rpy="0.0 0.0 0"/>
      <dynamics damping="0.2" friction="0.3"/>
    </joint>

    <joint name="${prefix}rear_left_wheel_joint" type="continuous">
      <axis xyz="0 1 0" rpy="0 0 0"/>
      <parent link="${prefix}rear_left_motor"/>
      <child link="${prefix}rear_left_wheel"/>
      <origin xyz="0 ${wheels_y_offset/scale_factor} 0.0" rpy="0.0 0.0 0"/>
      <dynamics damping="0.2" friction="0.3"/>
    </joint>

    <joint name="${prefix}front_right_wheel_joint" type="continuous">
      <axis xyz="0 1 0" rpy="0 0 0"/>
      <parent link="${prefix}front_right_motor"/>
      <child link="${prefix}front_right_wheel"/>
      <origin xyz="0 -${wheels_y_offset/scale_factor} 0.0" rpy="0.0 0.0 0"/>
      <dynamics damping="0.2" friction="0.3"/>
    </joint>

    <joint name="${prefix}rear_right_wheel_joint" type="continuous">
      <axis xyz="0 1 0" rpy="0 0 0"/>
      <parent link="${prefix}rear_right_motor"/>
      <child link="${prefix}rear_right_wheel"/>
      <origin xyz="0 -${wheels_y_offset/scale_factor} 0.0" rpy="0.0 0.0 0"/>
      <dynamics damping="0.2" friction="0.3"/>
    </joint>

    <joint name="${prefix}laser_joint" type="fixed">
      <parent link="${prefix}chassis"/>
      <child link="${prefix}laser_frame"/>
      <origin xyz="0 0 -0.04" rpy="0 ${PI} 0"/>
    </joint>


  </xacro:macro>
</robot>
